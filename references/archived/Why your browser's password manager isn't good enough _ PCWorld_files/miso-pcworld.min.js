!function(){"use strict";function t(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}function e(t){return null!=t?"".concat(t):t}function n(t){if("object"!=typeof t)return t;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0===t[e]&&delete t[e];return t}function o(t,e,n){Object.defineProperties(t,(n="string"==typeof n?[n]:n).reduce(((t,n)=>(t[n]="function"==typeof e[n]?{value:e[n].bind(e)}:{get:()=>e[n]},t)),{}))}function s(t,e){for(const n in e)e.hasOwnProperty(n)&&Object.defineProperty(t,n,{value:e[n]})}function r(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function i(t,e){const n=window.localStorage.getItem(t),o=function(t){const e="; ".concat(document.cookie),n="; ".concat(encodeURIComponent(t),"="),o=e.indexOf(n);if(0>o)return;const s=o+n.length,r=e.indexOf(";",s);return decodeURIComponent(0>r?e.substring(s):e.substring(s,r))}(t),s=n||o||"".concat(e());return s&&!n&&window.localStorage.setItem(t,s),s&&!o&&function(t,e){document.cookie="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e),"; max-age=31536000; path=/")}(t,s),s}class a{constructor(){const t=this;t.promise=new Promise(((e,n)=>{t.resolve=e,t.reject=n})),Object.freeze(this)}}class c{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new a;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class u{constructor(){let{error:t,replays:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._error=t||(t=>console.error(t)),!Array.isArray(e))throw Error("Replays option must be an array of strings: ".concat(e));this._replays=new Set(e),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}emit(t,e){const n={data:e,meta:{name:t,ts:Date.now()}},o=this._namedCallbacks[t];if(o)for(const t of o)t(n);for(const t of this._unnamedCallbacks)t(n);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(n)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((n,o)=>{const s=e._on(t,(t=>{setTimeout((()=>s()));try{n(t)}catch(t){o(t)}}))}))}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: ".concat(t))}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: ".concat(t))}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return n=>{let{data:o,meta:s}=n;try{t(o,s)}catch(t){e._error(Error("Error in callback of event '".concat(s.name,"': ").concat(t.message),{cause:t}))}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(e,n){if("*"===e)t(this._unnamedCallbacks,n);else{const o=this._namedCallbacks[e];o&&t(o,n)}}_injectSubscribeInterface(t){o(t,this,["on","once"])}}function d(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class l{constructor(t,e){const n=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error('Invalid Component name: "'.concat(t,'"'));return Object.freeze({name:t,parent:e,path:d(t,e),uuid:r()})}(t,e);s(this,{meta:n});const o=this._error=this._error.bind(this);(this._events=new u({error:o,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=n.parent)&&e._events&&e._events.emit("child",this)}_warn(){const t=this.meta.parent;(t&&t._warn||console.warn)(...arguments)}_error(){const t=this.meta.parent;(t&&t._error||console.error)(...arguments)}}!function(t,e){const n=Symbol.for(e);Object.defineProperty(t,n,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[n]})}(l,"miso:component");class p extends l{constructor(t,e){let{libName:n,keyName:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(t,e),this._events._replays.add("register"),this._libraries={},this._libName=n,this._keyName=o}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}register(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];for(const t of e)this._register(t)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect ".concat(this._libName," ").concat(this._keyName," to be a non-empty string: ").concat(t))}_checkLib(t){if("function"!=typeof t)throw Error("Expect ".concat(this._libName," to be a constructor or function: ").concat(t))}_register(t){this._checkLib(t);const e=t[this._keyName];this._checkKey(e);const n=this._libraries||(this._libraries={});n[e]=t,this._events.emit("register",t)}}const h={DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"};class _{constructor(t,e){this._client=t,this._root=e,this._bulk=new c(this._runBulkFetch.bind(this),t._error.bind(t))}assertReady(){}async fetch(t,e){let{method:n="POST",timeout:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=JSON.stringify(e),r=o&&new AbortController,i=r&&r.signal,a=r&&setTimeout((()=>r.abort()),o),c=await window.fetch(t,{method:n,body:s,cache:"no-cache",mode:"cors",signal:i});a&&clearTimeout(a);const u=await c.json();if(c.status>=400||u.errors){var d=Error(u.message);throw d.data=u,d.status=c.status,d}return u}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,n){let{method:o}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o&&"POST"!==o)throw Error("Non-POST API is not supported in bulk mode: ".concat(url));return this._bulk.run({apiGroup:t,apiName:e,payload:n})}async _runBulkFetch(t){const e=this.url("bulk"),n={requests:t.map((t=>{let{action:{apiGroup:e,apiName:n,payload:o}}=t;return{api_name:"".concat(e,"/").concat(n),body:o}}))},{data:o}=await this.fetch(e,n);for(let e=0,n=t.length;n>e;e++){const{resolution:n}=t[e],{error:s,status_code:r,body:i}=o[e];r>=400||s?n.reject({status_code:r,body:i}):n.resolve(i)}}sendBeacon(t,e){let{method:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n&&"POST"!==n)throw Error("Non-POST API is not supported in useBeacon mode: ".concat(t));if(!window.navigator.sendBeacon(t,JSON.stringify(e)))throw Error("Send beacon unsuccessful: ".concat(t))}url(){const{apiKey:t}=this._client.options;for(var e=arguments.length,n=Array(e),o=0;e>o;o++)n[o]=arguments[o];const s=n.filter((t=>t)).join("/");return"".concat(this.getApiEndpoint(s),"/").concat(s,"?api_key=").concat(window.encodeURIComponent(t))}getApiEndpoint(t){const{dataEndpoint:e=h.DATA_ENDPOINT,eventEndpoint:n=h.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?n:e}applyUrlPasses(t,e){let{apiGroup:n,apiName:o,url:s}=e;const r=this._client;for(const e of this._root._urlPasses)try{s=e({client:r,apiGroup:n,apiName:o,url:s})||s}catch(e){t.error(e)}return s}applyPayloadPasses(t,e){let{apiGroup:n,apiName:o,payload:s}=e;const r=this._client;for(const e of this._root._payloadPasses)try{s=e({client:r,apiGroup:n,apiName:o,payload:s})||s}catch(e){t.error(e)}return s}}class m extends l{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.helpers.assertReady();const{bulk:o}=n,s=o?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,i=this._url({apiGroup:r,apiName:t,payload:e,options:n}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:n}),url:i,options:n};this._events.emit("request",{...a,...s});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...s}),this._postprocess(u)}_preprocess(t){let{apiGroup:e,apiName:n,payload:o}=t;return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:n,payload:o})}_url(t){let{apiGroup:e,apiName:n}=t;const o=this.helpers.url(e,n);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:n,url:o})}async _send(t){let{apiGroup:e,apiName:n,url:o,payload:s,options:{bulk:r,timeout:i}={}}=t;return r?this.helpers.fetchForBulk(e,n,s):this.helpers.fetch(o,s,{timeout:i})}_postprocess(t){let{response:e}=t;return e.data}}class f extends m{constructor(t){super(t,"interactions")}async upload(t,e){try{return await this._run("upload",t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url(t){let{apiGroup:e,apiName:n}=t;const o=this.helpers.url(this._apiPath);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:n,url:o})}_preprocess(t){let{apiGroup:e,apiName:n,payload:o}=t;return"upload"===n&&(o=this._normalizeUploadPayload(o)),super._preprocess({apiGroup:e,apiName:n,payload:o})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: ".concat(t));return Array.isArray(t)||(t=[t]),{data:t}}async _send(t){let{options:{useBeacon:e=!0,...n}={},...o}=t;if(e){const{url:t,payload:e}=o;return this.helpers.sendBeacon(t,e,n),{}}return super._send({...o,options:n})}}class y extends m{constructor(t){super(t,"search")}async search(t,e){return this._run("search",t,e)}async autocomplete(t,e){return this._run("autocomplete",t,e)}async mget(t,e){return this._run("mget",t,e)}}class g extends m{constructor(t){super(t,"recommendation")}async userToProducts(t,e){return this._run("user_to_products",t,e)}async userToCategories(t,e){return this._run("user_to_categories",t,e)}async userToAttributes(t,e){return this._run("user_to_attributes",t,e)}async userToTrending(t,e){return this._run("user_to_trending",t,e)}async userToHistory(t,e){return this._run("user_to_history",t,e)}async productToProducts(t,e){return this._run("product_to_products",t,e)}}class w extends l{constructor(t,e){super("api",t),this._client=t,this.helpers=new _(t,e),this.interactions=new f(this),this.search=new y(this),this.recommendation=new g(this)}}class b extends l{constructor(t){super("context",t),this._client=t}}var v={api:{Api:w,ApiBase:m,ApiHelpers:_,Interactions:f,Recommendation:g,Search:y},context:{Context:b}};class x{constructor(t){s(this,{install:t})}}class k extends p{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._events._replays.add("install").add("subtree"),this._installed={},this._useRequests={},this._subtrees=[],this.context=new P(this,v),this.plugins=new I(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let n;if("string"==typeof t&&this.isInstalled(t))return n=this.get(t),void this._tryConfig(n,e);"string"!=typeof t||this.isRegistered(t)?(n=this._instantiate(t,e),this._install(n)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: ".concat(t));this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: ".concat(t));this._root._urlPasses.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?t.config(e):this._warn('Attempt to pass options to plugin "'.concat(t.id,'", which offers no config() method.')))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const n=this._libraries[t];if(!n)throw Error("Plugin class not found: ".concat(t));const o=new n;return s(o,{id:t}),this._tryConfig(o,e),o;case"function":return new x(t)}throw Error("Unexpected parameters: ".concat(t))}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: ".concat(t));try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const n of e)try{this.use(t,n)}catch(t){this._error(t)}delete this._useRequests[t]}}}class P{constructor(t,e){o(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass"]),s(this,{classes:e})}}class I{constructor(t){o(this,t,["installed","registered","isInstalled","isRegistered","get","register","use"])}}const E=new class extends l{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new k(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this.version="1.4.5"}get instances(){return[...this._clients]}};class R extends l{constructor(t){var e;super("client",E),this._config(t),this.context=new b(this),this.api=new w(this,E),E._clients.push(e=this),E._events.emit("create",e)}get version(){return R.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,n(t)}_readConfigFromScriptUrl(){const t=document.currentScript;return n({apiKey:new URL(new Request(t.src||t.href).url).searchParams.get("api_key")||void 0})}}function C(t,e){try{e()}catch(e){t(e)}}function N(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>console.error(t);const n=window[t]||(window[t]=[]);if(n._processed)return;n._processed=!0;const o=t=>C(e,t);Object.defineProperty(n,"push",{value:o});for(const t of n)o(t)}window.MisoClient?console.warn("Use already defined window.MisoClient (".concat(window.MisoClient.version,").")):(window.MisoClient=function(t){const e=E._pluginRoot;return E.MisoClient=e.MisoClient=t,o(t,E,["version","instances","meta","on","once"]),o(t,e,["plugins"]),t}(R),N("misodev"),setTimeout((()=>N("misocmd"))));var O=window.MisoClient;class U{constructor(){}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=i("miso_anonymous_id",r))}set anonymous_id(t){this._anonymousId=e(t)}get user_id(){return this._userId}set user_id(t){this._userId=e(t)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t}}function j(){const t=new URLSearchParams(window.location.search);let e=n({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}const A="%cMiso",T="color: #fff; background-color: #334cbb; padding: 2px 2px 1px 4px;",$=function(t,e){for(var n=arguments.length,o=Array(n>2?n-2:0),s=2;n>s;s++)o[s-2]=arguments[s];return console.log(A,T,L(t),q(e),...o)};function S(t,e,n){void 0===n?$(t,e):Array.isArray(n)?$(t,e,...n.map(M)):$(t,e,M(n))}function L(t){return"<".concat("string"==typeof t?t:t.filter((t=>t)).join("/"),">")}function q(t){return"[".concat(t,"]")}function M(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}O.plugins.register(class{constructor(){this._log=console.log.bind(console,A,T)}static get id(){return"std:debug"}install(t){this._injectComponents(t)}_injectComponents(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(n=>this._injectComponents(n,e.concat(t.meta.path)))),t.on("*",((n,o)=>this._handleEvent(t,o,n,e)))}_handleEvent(t,e,n){let{name:o}=e;if("child"===o||"subtree"===o)return;const s=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:[]).concat(t.meta.path);if(s.length||"create"!==o){switch(s[0]){case"client":if("api"===s[1])return void this._handleApiEvent(o,{...n,groupName:s[2]});break;case"plugins":return void(1===s.length?this._handlePluginsEvent(o,n):this._handlePluginSpecificEvent(s[1],s.slice(2),o,n))}S(s.join("."),o,n)}else this._handleCreateClient(o,n)}_handleCreateClient(t,e){S("client",t,e)}_handleApiEvent(t,e){let{groupName:n,apiName:o,url:s,bulk:r,...i}=e;const a=new URL(s).pathname,c=["api",t];if(r&&c.push("(bulk ".concat(r.bulkId,")")),c.push("POST ".concat(a)),"interactions"===n){const{type:t}=i.payload.data[0];c.push(t)}c.push([{...i,url:s}]),$.apply(void 0,c)}_handlePluginsEvent(t,e){$("plugins",t,"".concat(e.id||"(anonymous)"),[e])}_handlePluginSpecificEvent(t,e,n,o){S([t,e.join(".")],n,o)}_getPath(t){const e=[];for(let n=t;n;n=n.meta.parent)n.meta.name&&e.push(n.meta.name);return e.reverse()}},class{constructor(){this._options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,e){let{addUrlPass:n}=e;n(this._modifyUrl.bind(this))}_modifyUrl(t){let{apiGroup:e,apiName:n,url:o}=t;return"interactions"===e&&"upload"===n?function(t,e,n){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: ".concat(e));return void 0===n&&(n="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent("".concat(n))}(o,"dry_run","1"):o}}),O.plugins.use(class{static get id(){return"std:user"}constructor(){}install(t,e){let{addPayloadPass:n}=e;t.on("create",this._injectClient.bind(this)),n(this._modifyPayload.bind(this))}_injectClient(t){const e=t._userContext=new U;var n,o;n=e,Object.defineProperties(t.context,(o="string"==typeof(o=["anonymous_id","user_id","user_hash"])?[o]:o).reduce(((t,e)=>(t[e]={get:()=>n[e],set:t=>{n[e]=t}},t)),{}))}_modifyPayload(t){let{client:e,apiGroup:n,apiName:o,payload:s}=t;return"interactions"===n&&"upload"===o?this._modifyPayloadForInteractions(e,s):this._modifyPayloadForOthers(e,s)}_modifyPayloadForOthers(t,e){const{user_id:n,user_hash:o,anonymous_id:s}=t.context;return{...n?{user_id:n,user_hash:o}:{anonymous_id:s},...e}}_modifyPayloadForInteractions(t,e){let{data:o}=e;const{anonymous_id:s,user_id:r}=t.context,i=n({anonymous_id:s,user_id:r});return o=o.map((t=>({...i,...t}))),{data:o}}}),O.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,e){let{addPayloadPass:n}=e;n(this._modifyPayload.bind(this))}_modifyPayload(t){let{apiGroup:e,apiName:n,payload:o}=t;return"interactions"===e&&"upload"===n?this._modifyPayloadForInteractions(o):o}_modifyPayloadForInteractions(t){let{data:e}=t;return e=e.map((t=>({...t,context:{...n({page:n({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:j()}),...t.context}}))),{data:e}}});var D=function(){const t=document.currentScript;if(!t||!t.src)return Object.freeze({});const e=document.createElement("a");e.href=t.src;let n=e.search;return"?"===n.charAt(0)&&(n=n.substring(1)),Object.freeze(n.split("&").reduce(((t,e)=>{if(e){const[n,o]=e.split("=");t[n]=void 0===o||o}return t}),{}))}(),F="1.0.21";function G(...t){window.MisoClient&&window.MisoClient.plugins.isInstalled("std:debug")&&function(...t){console.log("%cMiso","color: #fff; background-color: #334cbb; padding: 2px 2px 1px 4px;",...t)}(...t)}const z=864e5;let B;async function H(){return B||(B=async function(){return async function(t,{interval:e=300,timeout:n}={}){const o=t();return null!=o?o:new Promise(((o,s)=>{let r,i;function a(){r&&clearInterval(r),i&&clearTimeout(i)}r=setInterval((()=>{const e=t();null!=e&&(a(),o(e))}),e),n&&n>0&&(i=setTimeout((()=>{a(),s(Error("Timeout: "+n))}),n))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function K(t){const e={};try{const n=(await async function(t){if(!t)throw Error("Blank post ID.");const e=`https://b2c-contenthub.com/wp-json/wp/v2/posts/${t}?_embed=1`;return(await window.fetch(e)).json()}(t))._embedded["wp:term"];for(const t of n)t.length>0&&"story_types"===t[0].taxonomy&&(e.storyTypes=t.map((t=>t.name)))}catch(e){console.error("Cannot extract story types: "+t),console.error(e)}return e}const V=new Set(["News","Feature","How-To","Opinion"]),J={techadvisor:323242,macworld:323243,techhive:323244,pcworld:323245};async function W(t,e,n){if(0===n.length)return[];const o=`/wp-json/idg/v2/${e}?include=${n.join(",")}&article_id=${t.postId}&per_page=100&_embed=1`,s=await window.fetch(o);return await s.json()}function X(t){return t.product_id.replace("product_","")}async function Q(t,e){if(0===e.length)return{};const n=await W(t.pageInfo,"deals-view",e);for(const e in n)n[e]=tt(n[e],{...t,id:e});return n}const Y='data-vars-link-position="',Z='data-miso-attribution="miso-ipp" data-miso-product-type="deal" ';function tt(t,e){return t=function(t,{pageInfo:e}){const{amazon_us_tag:n}=e.site;if(!n)return t;try{const{html:e}=t,r=e.indexOf('"https://go.redirectingat.com/'),i=0>r?-1:e.indexOf('"',r+1);if(i>=0){const{searchParams:a}=new URL((o=e.substring(r+1,i),(s=document.createElement("textarea")).innerHTML=o,s.value)),c=new URL(a.get("url"));c.hostname.endsWith("amazon.com")&&(c.searchParams.set("tag",n),a.set("url",""+c),t.html=e.substring(0,r+1)+""+a+e.substring(i),G("[Recommendation] Replaced Amazon link tag in deal view."))}}catch(t){console.error("Failed to replace Amazon link tag."),console.error(t)}var o,s;return t}(t=function(t){try{const{html:e}=t,n=e.indexOf(Y);if(0>n)throw Error(`Cannot find '${Y}' in product view HTML.`);t.html=e.substring(0,n)+Z+e.substring(n)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t),e)}var et={block:{title:"Today's Best Deals"},text:{from:"From",was:"Was",now:"Now",view_deal:"View deal"}},nt={block:{title:"Die besten Angebote des Tages"},text:{from:"Von",was:"Vorher",now:"Jetzt",view_deal:"Angebot ansehen"}};function ot(t){return"de"===t?nt:et}async function st(t,e){if(0===e.length)return{};const n=await async function(t){const e=`https://b2c-contenthub.com/wp-json/wp/v2/deal?include=${t.join(",")}&per_page=100&_embed=1`;return(await window.fetch(e)).json()}(e);G("[Recommendation] Fetched deals",n);const o={};for(const e of n)o[e.id]=rt(e,t);return o}function rt({id:t,meta:{deal_description:e,deal_info:n},_embedded:{"wp:featuredmedia":o}},{pageInfo:s}){const{site:r}=s,i=o&&o[0],{deal_info:a}=JSON.parse(n),{display_name:c,deal_url:u,deal_price:d,original_price:l,discount_price:p,source_name:h}=a,_=function({site:t,productId:e,productName:n,outboundLink:o}){const s=ot(t.lang);return`<a class="price-comparison__view-button" \n    style="float: none; display: inline-block; margin: 1em 0;"\n    href="${function(t,e){return 0>new URL(e).hostname.indexOf("amazon.")?`https://go.redirectingat.com/?id=803X1716261&xcust=IPP&url=${encodeURIComponent(e)}&sref=${encodeURIComponent(window.location.href)}`:`https://buy.geni.us/Proxy.ashx?TSID=${J[t.key]}&GR_URL=${encodeURIComponent(e)}`}(t,o)}"\n    data-vars-product-name="${n}" \n    data-vars-product-id="${e}" \n    data-product="${e}" \n    data-vars-link-position-id="099" \n    data-vars-link-position="Miso" \n    data-vars-outbound-link="${o}" \n    data-miso-attribution="miso-ipp" \n    data-miso-product-type="deal" \n    target="_blank" rel="nofollow">${s.text.view_deal}</a>`}({site:r,productId:t,productName:c,outboundLink:u}),m=ot(r.lang),f=`\n<div class="wp-block-product-widget-block product-widget">\n  <div class="product-widget__block-title-wrapper">\n    <h4 class="product-widget__block-title" id="">${m.block.title}</h4>\n  </div>\n  <div class="product-widget__content-wrapper">\n    <div class="product-widget__title-wrapper">\n      <h3 class="product-widget__title" id="">${c}</h3>\n    </div>\n    ${function(t){if(!t)return"";return`\n<div class="product-widget__image-outer-wrapper">\n  <div class="product-widget__image-wrapper">\n    <img class="product-widget__image" src="${t.source_url}" loading="lazy" alt="${t.title.rendered}">\n  </div>\n</div>`}(i)}\n    <div class="product-widget__information">\n      <div class="product-widget__information--rrp-wrapper">\n        <span class="product-widget__information--rrp-value">${m.text.from}:</span>&nbsp;<span class="product-widget__information--rrp-value">${h}</span>\n      </div>\n      ${function(t,e){if(!e)return"";return`\n  <div class="product-widget__pricing-details" style="margin-bottom: 5px;">\n  <span class="product-widget__pricing-details--label" style="font-weight: inherit;">${ot(t.lang).text.was}:</span>&nbsp;<span class="product-widget__pricing-details--label" style="font-weight: inherit;">${e}</span>\n</div>`}(r,l)}\n      <div class="product-widget__pricing-details" style="font-weight: bold; margin-bottom: 5px;">\n        <span class="product-widget__pricing-details--label">${m.text.now}:</span>&nbsp;<span class="product-widget__pricing-details--label">${d} ${p}</span>\n      </div>\n      <div class="price-comparison" style="border: none; margin-bottom: 5px; text-align: left;">\n        ${_}\n      </div>\n      <div>\n        ${e}\n      </div>\n    </div>\n  </div>\n</div>`;return{html:f}}function it({type:t,site:e,storyId:n},o){const{geo:s}=D,r={source:"miso-client-script",script_version:F,attribution:"miso-ipp",site:e.key,user_geo:s,product_types:o.map((t=>t.type))};return"story"===t&&n&&(r.story_id=n),r}async function at(t,e){if(0===e.length)return{};const n=await W(t.pageInfo,"products-view",e);for(const e in n)n[e]=ct(n[e],{...t,id:e});return n}function ct(t,e){return!!function({html:t},{id:e,client:n,pageInfo:o}){if("false"===config.prod_check||"0"===config.prod_check)return G("[Recommendation] Product view validation waived due to prod_check=0 flag"),!0;if(0>t.indexOf(ut))return G(`[Recommendation] Exclude product ${e} due to lack of outbound link.`),n.api.interactions.upload({type:"custom",custom_action_name:"invalid_product_view",product_ids:["product_"+e],context:{custom_context:it(o,[{type:"product"}])}}),!1;return!0}(t,e)&&(t=function(t){try{const{html:e}=t,n=e.indexOf(pt);if(0>n)throw Error(`Cannot find '${pt}' in product view HTML.`);t.html=e.substring(0,n)+ht+e.substring(n)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t=function(t,{pageInfo:e}){const{html:n}=t,o=ot(e.site.lang);return t.html=n.replace(lt,`${dt}${o.block.title}</h4>`),t}(t,e)))}const ut='data-vars-outbound-link="',dt='<h4 class="product-widget__block-title" id="">',lt=dt+"</h4>",pt='data-vars-outbound-link="',ht='data-miso-attribution="miso-ipp" data-miso-product-type="product" ';function _t(t,e,n){if(!n)return;G("[Recommendation] Capturing impression event...");const o=new IntersectionObserver((n=>{if(n[0].isIntersecting){try{o.disconnect()}catch(t){console.error(t)}!function({client:t,pageInfo:e},n){if(mt)return;mt=!0,t.api.interactions.upload({type:"impression",product_ids:n.map((t=>t.product_id)),context:{custom_context:it(e,n)}}),G("[Recommendation] Impression event sent.")}(t,e)}}),{threshold:.5});o.observe(n)}let mt=!1;async function ft(t){const{client:e,pageInfo:n}=t;if("story"!==n.type)return void G(`[Recommendation] No block shown: not a story page (${n.type})`);const{storyTypes:o=[]}=await K(n.postId)||{};if(!o.some((t=>V.has(t))))return void G("[Recommendation] No block shown: not applied for story_type: "+o.join(", "));const s=document.querySelector("#link_wrapped_content > p:nth-of-type(6)")||document.querySelector("#link_wrapped_content > p:last-of-type");if(!s)return void G("[Recommendation] No block shown: cannot find the reference position for recommendation block.");G("[Recommendation] Fetching results from Miso API...");const r=await gt(t);if(0===r.length)return void G("[Recommendation] No block shown: no result from Miso API.");G("[Recommendation] Building views...");const i=await async function(t,e){const n=[],o=[];for(const t of e)switch(t.type){case"product":n.push(X(t));break;case"deal":o.push(X(t));break;default:throw Error("Unrecognized product type: "+t.type)}const{deal_v2:s}=D,[r,i]=await Promise.all([at(t,n),(s?Q:st)(t,o)]),a={...r,...i};return e.map((t=>a[X(t)])).filter((t=>t)).map((t=>t&&t.html||"")).join("")}(t,r);i&&(G("[Recommendation] Inserting view HTML on page..."),s.insertAdjacentHTML("afterend",i),G("[Recommendation] Rendered successfully."),e.api.interactions.upload({type:"custom",custom_action_name:"display",product_ids:r.map((t=>t.product_id)),context:{custom_context:it(n,r)}}),_t(t,r,s.nextElementSibling))}function yt(){const{geo:t,rec_type:e}=D;if(e&&"product"!==e&&"deal"!==e)throw Error('Type parameter should be either "product", "deal", or absent: '+e);const n=Date.now();let o;const s=function(t){if(t)switch(t=t.toLowerCase()){case"us":case"gb":return t;case"de":case"at":case"ch":return"eu";default:return}}(t),r=function(t){if(t)switch(t){case"us":return 9910;case"gb":return 17657;case"eu":return 22080;default:return}}(s);if((!e||"deal"===e)&&s){o='type:"deal"';const t=function(t){const e=new Date(t);return e.setMinutes(0,0,0),e}(n).toISOString();o+=` AND custom_attributes.start_date:["${function(t,e){let n=Math.floor((e||Date.now())/z)-t;return new Date(n*z)}(28,n).toISOString()}" TO "${t}"]`,o+=` AND custom_attributes.end_date:["${t}" TO *]`,o+=` AND custom_attributes.geo_tags:"${s}"`;const e="custom_attributes.idg_deal_territories:0";o+=" AND "+(r?`(${e} OR custom_attributes.idg_deal_territories:${r})`:e)}return o}async function gt(t,e={}){const{client:n,pageInfo:o}=t,s=yt();if(!s)return[];e={product_id:o.storyId,fl:["type"],fq:s,rows:1,...e};try{return(await n.api.recommendation.productToProducts(e)).products}catch(t){return console.error(t),[]}}const wt=["product-name","link-position-id","link-position","outbound-link"],bt=["attribution","product-type"];(async t=>{const e="false"!==D.ui&&"0"!==D.ui&&!1!==t.ui;if(window.miso_script_version)return void console.warn("Script already executed: "+window.miso_script_version);window.miso_script_version=F;G("Miso script version: 1.0.21");const n=window.miso=new O({readConfigFromScriptUrl:!0});n.context.anonymous_id=await async function(t,e){const n=(new TextEncoder).encode(e),o=await crypto.subtle.digest(t,n);return btoa(new Uint8Array(o).reduce(((t,e)=>t+String.fromCharCode(e)),""))}("SHA-1",await async function(){return(await H()).get("clientId")}());const o=function(t){const e=window.location.pathname;if("/"===e)return{type:"home",site:t};const n=e.substring(1).split("/");if("article"===n[0]){const e=""+n[1];return{type:"story",site:t,postId:e,storyId:`story_${t.key}_${e}`}}return{type:"other",site:t}}(t),s={client:n,pageInfo:o};!function({client:t,pageInfo:e}){const{type:n,site:o,storyId:s}=e,{geo:r}=D;switch(n){case"home":t.api.interactions.upload({type:"home_page_view",context:{custom_context:{source:"miso-client-script",script_version:F,site:o.key,user_geo:r}}});break;case"story":t.api.interactions.upload({type:"product_detail_page_view",product_ids:[s],context:{custom_context:{source:"miso-client-script",script_version:F,site:o.key,user_geo:r}}})}}(s),function({client:t,pageInfo:e}){const{type:n,site:o,storyId:s}=e;document.addEventListener("click",(e=>{if(e.defaultPrevented)return;const r=e.target;if(!r.tagName||"a"!==r.tagName.toLowerCase())return;const i=r.getAttribute("data-product");if(!i)return;const a="product_"+i,{geo:c}=D,u={source:"miso-client-script",script_version:F,site:o.key,user_geo:c};"story"===n&&s&&(u.story_id=s);for(const t of wt){const e=r.getAttribute("data-vars-"+t);e&&(u[t.replaceAll("-","_")]=e)}for(const t of bt){const e=r.getAttribute("data-miso-"+t);e&&(u[t.replaceAll("-","_")]=e)}if(u.product_type)u.product_types=[u.product_type],delete u.product_type;else{const t=function(t){for(;(t=t.parentElement)&&!t.classList.contains(kt);){for(const e of vt)if(t.classList.contains(e))return"product";for(const e of xt)if(t.classList.contains(e))return"deal"}return}(r);t&&(u.product_types=[t])}t.api.interactions.upload({type:"checkout",product_ids:[a],context:{custom_context:u}})}))}(s),e&&ft(s)})({key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",amazon_us_tag:"pcworld-ipp-20",lang:"en"});const vt=["product-chart-item","product-widget"],xt=["price-comparison"],kt="link_wrapped_content"}();
